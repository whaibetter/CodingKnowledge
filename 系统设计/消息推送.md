### 消息推送常见方案有哪些？

- 短轮询：不断发
- 长轮询：有结果后再发
- SSE(Server-Sent Events)：（不需要从客户端发送数据。而你只需要一些服务器操作的更新）客户端click事件，客户端就返回了。
- WebSocket

### SSE是什么？

SSE代表**服务器发送事件（Server-Sent Events）**，是一种用于在**Web浏览器和服务器之间实现单向实时通信**的技术。SSE允许服务器向客户端推送数据，而不需要客户端发起请求。

### 使用SSE+线程池向客户端推送数据？

> 1. 客户端请求http
> 2. 服务端响应"`text/event-stream`"的打开流，随时可以发数据（发送数据取决于服务端）
> 3. 服务端监听事件

1. 客户端通过HTTP连接向服务器发送一个**普通的HTTP请求**，请求一个特殊的URL，**该URL与服务器端的SSE端点相关联**。
2. 服务器接收到请求后，返回一个HTTP响应，响应的内容类型被设置为**"text/event-stream"**，并且连接被**保持打开，不会立即关闭**。
3. 一旦连接保持打开，**服务器可以随时向客户端发送事件数据**。这些事件数据以简单文本格式发送，每个事件都包含一个事件名称和一个可选的数据字段。
4. **客户端通过监听事件的发生**，可以实时接收来自服务器的数据，并对其进行处理。

### WebSocket是什么？通信过程是什么样的？

是一种在 **TCP** 连接上进行全双工通信的协议，建立客户端和服务器之间的通信渠道，**一次握手，永久全双工连接。**

**过程：**

1. Client----HTTP(`Upgrade: websocket` 和 `Sec-WebSocket-Key`)-->Server
2. Client<----HTTP(status:101表示切换协议)------Server
   - 表示成功升级到 WebSocket 协议
3. 客户端和服务器之间**建立了一个 WebSocket 连接**，可以双向通信。
   - WebSocket 的每条消息可能会被切分成多个数据帧（最小单位）
4. 双方可以主动发送**关闭帧**

> WebSocket 的工作过程可以分为以下几个步骤：
>
> 1. 客户端向服务器发送一个 HTTP 请求，请求头中包含 `Upgrade: websocket` 和 `Sec-WebSocket-Key` 等字段，表示要求升级协议为 WebSocket；
> 2. 服务器收到这个请求后，会进行升级协议的操作，如果支持 WebSocket，它将回复一个 HTTP 101 状态码，响应头中包含 ，`Connection: Upgrade`和 `Sec-WebSocket-Accept: xxx` 等字段、表示成功升级到 WebSocket 协议。
> 3. 客户端和服务器之间建立了一个 WebSocket 连接，可以进行双向的数据传输。数据以帧（frames）的形式进行传送，而不是传统的 HTTP 请求和响应。WebSocket 的每条消息可能会被切分成多个数据帧（最小单位）。发送端会将消息切割成多个帧发送给接收端，接收端接收消息帧，并将关联的帧重新组装成完整的消息。
> 4. 客户端或服务器可以主动发送一个关闭帧，表示要断开连接。另一方收到后，也会回复一个关闭帧，然后双方关闭 TCP 连接。
>
> 另外，建立 WebSocket 连接之后，通过心跳机制来保持 WebSocket 连接的稳定性和活跃性。
>
> ------
>
> 著作权归JavaGuide(javaguide.cn)所有 基于MIT协议 原文链接：https://javaguide.cn/system-design/web-real-time-message-push.html